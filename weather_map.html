<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>USVI Weather</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <style>
        body {
            font-size: 0.95rem;
        }

        #weather {
            display: flex;
            justify-content: space-around;
        }

        .mapContainer {
            justify-content: center;
        }

        li {
            padding: 15px;
        }

        .card-body {
            padding: 0;
        }

        .cards {
            width: 50vw;
            padding: 0 1em;
        }
    </style>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet'/>
</head>
<body>
<div class="container-fluid">
    <div class="page-header text-center">
        <h1>Weather App</h1>
    </div>

    <form class="form-inline">
        <div class="form-group">
            <input type="text" class="form-control" id="search"
                   value="City or Place here...">
            <button type="submit" class="btn btn-primary">Find</button>
        </div>
    </form>
    <hr>
    <div class="location"></div>
    <hr>
    <div id="weather"></div>
    <hr>

    <div class="mapContainer">
        <div id='map' style='width: 80%; height: 50vh;'></div>
    </div>
    <hr>
</div>
<script src="js/keys.js"></script>
<script src="js/mapbox-geocoder-utils.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
<script>
    (function () {
        "use strict";
        mapboxgl.accessToken = mapboxToken;


        $.get("http://api.openweathermap.org/data/2.5/forecast", {
            APPID: openWeatherKey,
            coord: {"lat": "-64.969414", "lon": "18.327129"},
            units: "imperial"
        }).done(function (data) {
            console.log(data);
            let headerHTML = '<h1>' + data.city.name + '</h1>';
            $('.location').append(headerHTML);
            for (let i = 0; i <= data.list.length - 1; i = i + 8) {
                let date = data.list[i].dt_txt.substring(0, 10);
                let iconURL = "http://openweathermap.org/img/w/" + data.list[i].weather[0].icon + ".png";
                let finalHTML =
                    '<div class="cards">' +
                    '<div class="card text-center">' +
                    '<div class="card-header">' + date + '</div>' +
                    '<div class="card-body"> ' +
                    '<ul class="list-group list-group-flush">' +
                    '<li class="list-group-item">' + '<p class="font-weight-bold">' + data.list[i].main.temp + ' Â°F' + '</p>' + '<div><img id="img" class="img" alt=""></div> ' + '</li>' +
                    '<li class="list-group-item">' + 'Description: ' + '<p class="font-weight-bold">' + data.list[i].weather[0].description + '</p>' + '</li> ' +
                    '<li class="list-group-item">' + 'Humidity: ' + '<p class="font-weight-bold">' + data.list[i].main.humidity + '</p>' + '</li>' +
                    '<li class="list-group-item">' + 'Wind: ' + '<p class="font-weight-bold">' + +data.list[i].wind.speed + '</p>' + '</li>' +
                    '<li class="list-group-item">' + 'Pressure: ' + '<p class="font-weight-bold">' + data.list[i].main.pressure + '</p>' + '</li>' +
                    '</ul>' +
                    '</div>' +
                    '</div>' +
                    '</div>';

                $('#weather').append(finalHTML);
                $('.img').attr('src', iconURL);
                console.log(iconURL);
            }

            let map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v11', // stylesheet location
                center: [-64.969414, 18.327129], // starting position [lng, lat]
                zoom: 11, // starting zoom
            });

            let markerCoordinates =
                map.on('click', function (e) {
                    // getting latitude and longitude for weather app
                    var coordsObj = e.lngLat;
                    // // console.log(coordsObj);
                    // console.log('data.city' + data.city.coord.lat);
                    console.log('markercoord ' + coordsObj.lng);
                    var marker = new mapboxgl.Marker()
                        .setLngLat(coordsObj)
                        .addTo(map);
                    data.city.coord.lat = coordsObj.lat;
                    data.city.coord.lon = coordsObj.lng;

                })

            //change lat and longitude seperately

        })


//TODO fix icons, make all cards the same size, update weather to marker coordinates, make search bar functional

    })();
</script>
</body>
</html>